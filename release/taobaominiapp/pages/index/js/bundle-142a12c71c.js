var window = $global.window;
var document = window.document;
var XMLHttpRequest = window.XMLHttpRequest;
var Laya = window.Laya;
var Laya3D = window.Laya3D;
"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}(function(){'use strict';var Tween=Laya.Tween;var Ease=Laya.Ease;var Handler=Laya.Handler;var GuideText=/*#__PURE__*/function(_Laya$Script){_inherits(GuideText,_Laya$Script);function GuideText(){_classCallCheck(this,GuideText);return _possibleConstructorReturn(this,_getPrototypeOf(GuideText).call(this));}_createClass(GuideText,[{key:"onEnable",value:function onEnable(){var guideText=this.owner;var tweenProps1={scaleX:1,scaleY:1};var tweenProps2={scaleX:0.8,scaleY:0.8};var duringTime=350;function tweenLoop(){Tween.to(guideText,tweenProps1,duringTime,Ease.linearInOut,Handler.create(this,function(){Tween.to(guideText,tweenProps2,duringTime);}),null,true);}Laya.timer.loop(700,this,tweenLoop);}},{key:"onDisable",value:function onDisable(){}}]);return GuideText;}(Laya.Script);var Tween$1=Laya.Tween;var Ease$1=Laya.Ease;var Handler$1=Laya.Handler;var GuideBtn=/*#__PURE__*/function(_Laya$Script2){_inherits(GuideBtn,_Laya$Script2);function GuideBtn(){_classCallCheck(this,GuideBtn);return _possibleConstructorReturn(this,_getPrototypeOf(GuideBtn).call(this));}_createClass(GuideBtn,[{key:"onEnable",value:function onEnable(){var guideBtn=this.owner;guideBtn.x=196+358/2;guideBtn.y=1110+125/2;guideBtn.pivotX=358/2;guideBtn.pivotY=125/2;guideBtn.rotation=-5;function tweenLoop(){Tween$1.to(guideBtn,{rotation:5},300,Ease$1.linearNone,Handler$1.create(this,function(){Tween$1.to(guideBtn,{rotation:-5},300);}));}Laya.timer.loop(600,this,tweenLoop);}},{key:"onDisable",value:function onDisable(){}},{key:"onClick",value:function onClick(){Laya.Scene.open("gameScene.scene",true);}}]);return GuideBtn;}(Laya.Script);var Tween$2=Laya.Tween;var Sprite=Laya.Sprite;var Event=Laya.Event;var GuideRule=/*#__PURE__*/function(_Laya$Script3){_inherits(GuideRule,_Laya$Script3);function GuideRule(){_classCallCheck(this,GuideRule);return _possibleConstructorReturn(this,_getPrototypeOf(GuideRule).call(this));}_createClass(GuideRule,[{key:"onAwake",value:function onAwake(){var _mask=new Sprite();this._mask=_mask;_mask.loadImage("img/mask.png");_mask.pivot(375,667);_mask.x=375;_mask.y=667;_mask.alpha=0.7;_mask.zOrder=-1;_mask.scale(0,0);_mask.name="mask";var _close=new Sprite();_close.loadImage("img/close.png");_close.scale(0.5,0.5);_close.x=620;_close.y=60;_close.on(Event.CLICK,this,this.maskClose);_mask.addChild(_close);this.owner.scene.addChild(_mask);}},{key:"onClick",value:function onClick(){Tween$2.to(this._mask,{scaleX:1,scaleY:1,zOrder:1},500);}},{key:"maskClose",value:function maskClose(){Tween$2.to(this._mask,{scaleX:0,scaleY:0,zOrder:-1},500);}}]);return GuideRule;}(Laya.Script);var MoonCake=/*#__PURE__*/function(_Laya$Sprite){_inherits(MoonCake,_Laya$Sprite);function MoonCake(){var _this;_classCallCheck(this,MoonCake);_this=_possibleConstructorReturn(this,_getPrototypeOf(MoonCake).call(this));_this.cakeType=Math.random()>0.5?0:1;_this.loadImage(_this.cakeType==0?"http://enbrands.oss-cn-shenzhen.aliyuncs.com/game/midAutumn/images/IMG_GAME_FIGURE_1.png":"http://enbrands.oss-cn-shenzhen.aliyuncs.com/game/midAutumn/images/IMG_GAME_FIGURE_2.png");_this.pivot(380/2,407/2);return _this;}return MoonCake;}(Laya.Sprite);var Tween$3=Laya.Tween;var Sprite$1=Laya.Sprite;var Ease$2=Laya.Ease;var Handler$2=Laya.Handler;var Event$1=Laya.Event;var Label=Laya.Label;var MAX_SIZE=6;var queue=new Array(MAX_SIZE);var Game=/*#__PURE__*/function(_Laya$Script4){_inherits(Game,_Laya$Script4);function Game(){_classCallCheck(this,Game);return _possibleConstructorReturn(this,_getPrototypeOf(Game).call(this));}_createClass(Game,[{key:"init",value:function init(){var _this$owner;var _mooncake;for(var i=0;i<MAX_SIZE;i++){_mooncake=new MoonCake();_mooncake.x=375;_mooncake.y=850-i*76;_mooncake.scale(1-i*0.1,1-i*0.1);_mooncake.zOrder=6-i;queue[i]=_mooncake;}(_this$owner=this.owner).addChildren.apply(_this$owner,queue);}},{key:"onAwake",value:function onAwake(){this.init();}},{key:"onEnable",value:function onEnable(){var THIS_SCENE=this.owner.scene;var currentMoonCake;function dragCake(){currentMoonCake=queue[0];currentMoonCake.x=Laya.stage.mouseX;}function removeCake(){currentMoonCake=queue[0];var callbackFn=Handler$2.create(this,function(){Laya.stage.removeChild(currentMoonCake);currentMoonCake.destroy(true);queueUpdate();});if(Laya.stage.mouseX-375<0){addScore("left");Tween$3.to(currentMoonCake,{x:-190,alpha:0},200,Ease$2.linearNone,callbackFn);}else{addScore("right");Tween$3.to(currentMoonCake,{x:940,alpha:0},200,Ease$2.linearNone,callbackFn);}}function addScore(direction){var addScore=THIS_SCENE.getChildByName("add");var minusScore=THIS_SCENE.getChildByName("minus");var scoreText=THIS_SCENE.getChildByName("scoreText");addScore.y=560;minusScore.y=560;if(currentMoonCake.cakeType==0&&direction=="left"||currentMoonCake.cakeType==1&&direction=="right"){scoreText.text=parseInt(scoreText.text)+1+"";Tween$3.to(addScore,{alpha:1,y:260},200,Ease$2.linearNone,Handler$2.create(this,function(){Tween$3.to(addScore,{alpha:0},200,Ease$2.linearNone);}));}else{scoreText.text=parseInt(scoreText.text)-2+"";Tween$3.to(minusScore,{alpha:1,y:260},200,Ease$2.linearNone,Handler$2.create(this,function(){Tween$3.to(minusScore,{alpha:0},200,Ease$2.linearNone);}));}}Laya.stage.on(Event$1.MOUSE_MOVE,this,dragCake);Laya.stage.on(Event$1.MOUSE_UP,this,removeCake);function queueUpdate(){if(queue.length>0){queue.shift();}else{return;}if(queue.length>0){queue.forEach(function(item){item.zOrder++;var i=6-item.zOrder;Tween$3.to(item,{y:850-i*76,scaleX:1-i*0.1,scaleY:1-i*0.1},200);});var _newCake=new MoonCake();_newCake.x=375;_newCake.y=470;_newCake.scale(0,0);_newCake.zOrder=1;THIS_SCENE.addChildren(_newCake);Tween$3.to(_newCake,{scaleX:0.5,scaleY:0.5},200);queue.push(_newCake);}else{Laya.Scene.open("2.scene",true);}}var timer=THIS_SCENE.getChildByName("timer");var _count=60;Laya.timer.loop(1000,this,function(){_count--;if(_count>=10){timer.text="00:"+_count;}else{timer.text="00:0"+_count;}if(_count==0){openResult();}});function openResult(){Laya.stage.off(Event$1.MOUSE_MOVE,this,dragCake);Laya.stage.off(Event$1.MOUSE_UP,this,removeCake);var result=new Sprite$1();result.loadImage("img/mask.png");result.alpha=0.7;result.x=0;result.y=0;result.zOrder=999;var scoreLabel=new Label();scoreLabel.color="#ffffff";scoreLabel.fontSize=50;scoreLabel.align="center";scoreLabel.text="最终得分：\n"+THIS_SCENE.getChildByName("scoreText").text;scoreLabel.pivot(scoreLabel.width/2,scoreLabel.height/2);scoreLabel.x=375;scoreLabel.y=444;result.addChild(scoreLabel);result.on(Event$1.CLICK,this,function(){Laya.Scene.open("1.scene",true);});THIS_SCENE.addChild(result);}}},{key:"onDisable",value:function onDisable(){}}]);return Game;}(Laya.Script);var Tween$4=Laya.Tween;var Ease$3=Laya.Ease;var Handler$3=Laya.Handler;var Event$2=Laya.Event;var MAX_SIZE$1=6;var queue$1=new Array(MAX_SIZE$1);var GameStart=/*#__PURE__*/function(_Laya$Script5){_inherits(GameStart,_Laya$Script5);function GameStart(){_classCallCheck(this,GameStart);return _possibleConstructorReturn(this,_getPrototypeOf(GameStart).call(this));}_createClass(GameStart,[{key:"init",value:function init(){var _this$owner2;var _mooncake;for(var i=0;i<MAX_SIZE$1;i++){_mooncake=new MoonCake();_mooncake.x=375;_mooncake.y=850-i*76;_mooncake.scale(1-i*0.1,1-i*0.1);_mooncake.zOrder=6-i;queue$1[i]=_mooncake;}(_this$owner2=this.owner).addChildren.apply(_this$owner2,queue$1);}},{key:"onAwake",value:function onAwake(){var _this2=this;this.init();var tweenProps1={scaleX:1.25,scaleY:1.25};var tweenProps2={scaleX:1,scaleY:1};var _eat=this.owner.getChildByName("eat");var _go=this.owner.getChildByName("go");var duringTime=1000;function tweenLoopRight(){Tween$4.to(_eat,tweenProps1,duringTime,Ease$3.linearInOut,Handler$3.create(this,function(){Tween$4.to(_eat,tweenProps2,duringTime);}),null,true);}function tweenLoopLeft(){Tween$4.to(_go,tweenProps1,duringTime,Ease$3.linearInOut,Handler$3.create(this,function(){Tween$4.to(_go,tweenProps2,duringTime);}),null,true);}Laya.timer.loop(2*duringTime,this,tweenLoopRight);setTimeout(function(){Laya.timer.loop(2*duringTime,_this2,tweenLoopLeft);},1000);}},{key:"onEnable",value:function onEnable(){var hand=this.owner.scene.getChildByName("hand");var THIS_SCENE=this.owner.scene;function handMove(){var toRight={alpha:1,x:871};var toLeft={alpha:1,x:-123};Tween$4.clearAll(hand);hand.x=375;if(queue$1.length>0){if(queue$1[0].cakeType==0){Tween$4.to(hand,toLeft,1000).repeat=0;}else{Tween$4.to(hand,toRight,1000).repeat=0;}}else{THIS_SCENE.removeChild(hand);}}handMove();var currentMoonCake;function dragCake(){currentMoonCake=queue$1[0];currentMoonCake.x=Laya.stage.mouseX;}function removeCake(){currentMoonCake=queue$1[0];var callbackFn=Handler$3.create(this,function(){Laya.stage.removeChild(currentMoonCake);queueUpdate();});if(currentMoonCake.x-375<0){Tween$4.to(currentMoonCake,{x:-100,alpha:0},200,Ease$3.linearNone,callbackFn);}else{Tween$4.to(currentMoonCake,{x:850,alpha:0},200,Ease$3.linearNone,callbackFn);}}Laya.stage.on(Event$2.MOUSE_MOVE,this,dragCake);Laya.stage.on(Event$2.MOUSE_UP,this,removeCake);function queueUpdate(){if(queue$1.length>0){queue$1.shift();}else{return;}if(queue$1.length>0){queue$1.forEach(function(item){item.zOrder++;var i=6-item.zOrder;Tween$4.to(item,{y:850-i*76,scaleX:1-i*0.1,scaleY:1-i*0.1},200);});handMove();}else{Laya.Scene.open("2.scene",true);}}this.owner.getChildByName("startBtn").on(Event$2.CLICK,this,function(){Laya.Scene.open("2.scene",true);});}},{key:"onDisable",value:function onDisable(){}}]);return GameStart;}(Laya.Script);var GameConfig=/*#__PURE__*/function(){function GameConfig(){_classCallCheck(this,GameConfig);}_createClass(GameConfig,null,[{key:"init",value:function init(){var reg=Laya.ClassUtils.regClass;reg("script/GuideText.ts",GuideText);reg("script/guideBtn.ts",GuideBtn);reg("script/GuideRule.ts",GuideRule);reg("script/Game.ts",Game);reg("script/GameStart.ts",GameStart);}}]);return GameConfig;}();GameConfig.width=750;GameConfig.height=1334;GameConfig.scaleMode="fixedauto";GameConfig.screenMode="none";GameConfig.alignV="top";GameConfig.alignH="left";GameConfig.startScene="1.scene";GameConfig.sceneRoot="";GameConfig.debug=false;GameConfig.stat=false;GameConfig.physicsDebug=false;GameConfig.exportSceneToJson=true;GameConfig.init();var Main=/*#__PURE__*/function(){function Main(){_classCallCheck(this,Main);if(window["Laya3D"])Laya3D.init(GameConfig.width,GameConfig.height);else Laya.init(GameConfig.width,GameConfig.height,Laya["WebGL"]);Laya["Physics"]&&Laya["Physics"].enable();Laya["DebugPanel"]&&Laya["DebugPanel"].enable();Laya.stage.scaleMode=GameConfig.scaleMode;Laya.stage.screenMode=GameConfig.screenMode;Laya.stage.alignV=GameConfig.alignV;Laya.stage.alignH=GameConfig.alignH;Laya.URL.exportSceneToJson=GameConfig.exportSceneToJson;if(GameConfig.debug||Laya.Utils.getQueryString("debug")=="true")Laya.enableDebugPanel();if(GameConfig.physicsDebug&&Laya["PhysicsDebugDraw"])Laya["PhysicsDebugDraw"].enable();if(GameConfig.stat)Laya.Stat.show();Laya.alertGlobalError(true);Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION);}_createClass(Main,[{key:"onVersionLoaded",value:function onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded));}},{key:"onConfigLoaded",value:function onConfigLoaded(){GameConfig.startScene&&Laya.Scene.open(GameConfig.startScene);}}]);return Main;}();new Main();})();