var window = $global.window;
var document = window.document;
var XMLHttpRequest = window.XMLHttpRequest;
var Laya = window.Laya;
var Laya3D = window.Laya3D;
"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get;}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver);}return desc.value;};}return _get(target,property,receiver||target);}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break;}return object;}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}window.tbMiniGame=function(e,t){"use strict";var i=/*#__PURE__*/function(){function i(){_classCallCheck(this,i);}_createClass(i,null,[{key:"isLocalNativeFile",value:function isLocalNativeFile(e){for(var t=0,i=l.nativefiles.length;t<i;t++){if(-1!=e.indexOf(l.nativefiles[t]))return!0;}return!1;}},{key:"getFileInfo",value:function getFileInfo(e){var t=e,n=i.fakeObj[t];return null==n?null:n;}},{key:"read",value:function read(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"utf8";var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var o=arguments.length>4&&arguments[4]!==undefined?arguments[4]:!1;var r=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"";var l;l=""==s||-1==s.indexOf("http://")&&-1==s.indexOf("https://")?e:i.getFileNativePath(e),l=t.URL.getAdptedFilePath(l),i.fs.readFile({filePath:l,encoding:n,success:function success(e){null!=a&&a.runWith([0,e]);},fail:function fail(e){e&&""!=s?i.downFiles(s,n,a,s,o,r):null!=a&&a.runWith([1]);}});}},{key:"downFiles",value:function downFiles(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"utf8";var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:!1;var o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"";var r=arguments.length>6&&arguments[6]!==undefined?arguments[6]:!0;i.wxdown({url:e,success:function success(l){l.hasOwnProperty("statusCode")||(l.statusCode=200),200===l.statusCode?i.readFile(l.apFilePath,t,n,a,s,o,r):403===l.statusCode?null!=n&&n.runWith([0,e]):null!=n&&n.runWith([1,l]);},fail:function fail(e){null!=n&&n.runWith([1,e]);}}).onProgressUpdate(function(e){null!=n&&n.runWith([2,e.progress]);});}},{key:"readFile",value:function readFile(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"utf8";var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var o=arguments.length>4&&arguments[4]!==undefined?arguments[4]:!1;var r=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"";var d=arguments.length>6&&arguments[6]!==undefined?arguments[6]:!0;e=t.URL.getAdptedFilePath(e),i.fs.readFile({filePath:e,encoding:n,success:function success(t){!e.indexOf(l.window.my.env.USER_DATA_PATH)||-1==e.indexOf("http://")&&-1==e.indexOf("https://")?null!=a&&a.runWith([0,t]):o?(null!=a&&a.runWith([0,t]),i.copyFile(e,s,null,n,d)):null!=a&&a.runWith([0,t]);},fail:function fail(e){e&&null!=a&&a.runWith([1,e]);}});}},{key:"downOtherFiles",value:function downOtherFiles(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!1;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:!0;i.wxdown({url:e,success:function success(e){e.hasOwnProperty("statusCode")||(e.statusCode=200),200===e.statusCode?a&&-1==n.indexOf("qlogo.cn")&&-1==n.indexOf(".php")?(null!=t&&t.runWith([0,e.apFilePath]),i.copyFile(e.apFilePath,n,null,"",s)):null!=t&&t.runWith([0,e.apFilePath]):null!=t&&t.runWith([1,e]);},fail:function fail(e){null!=t&&t.runWith([1,e]);}});}},{key:"downLoadFile",value:function downLoadFile(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"utf8";var o=arguments.length>4&&arguments[4]!==undefined?arguments[4]:!1;window.navigator.userAgent.indexOf("AlipayMiniGame")<0?t.Laya.loader.load(e,a):n==t.Loader.IMAGE||n==t.Loader.SOUND?i.downOtherFiles(e,a,e,o,!1):i.downFiles(e,s,a,e,!0,n,o);}},{key:"copyFile",value:function copyFile(e,n,a){var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var o=arguments.length>4&&arguments[4]!==undefined?arguments[4]:!0;var r=e.split("/"),d=r[r.length-1],u=n,c=i.getFileInfo(n),h=i.getFileNativePath(d);i.fakeObj[u]={md5:d,readyUrl:n,size:0,times:t.Browser.now(),encoding:s};var f=i.getCacheUseSize();c?c.readyUrl!=n?i.fs.getFileInfo({filePath:e,success:function success(t){o&&f+4194304+t.size>=52428800&&(t.size>l.minClearSize&&(l.minClearSize=t.size),i.onClearCacheRes()),i.deleteFile(e,n,a,s,t.size);},fail:function fail(e){null!=a&&a.runWith([1,e]);}}):null!=a&&a.runWith([0]):i.fs.getFileInfo({filePath:e,success:function success(t){o&&f+4194304+t.size>=52428800&&(t.size>l.minClearSize&&(l.minClearSize=t.size),i.onClearCacheRes()),i.fs.copyFile({srcPath:e,destPath:h,success:function success(e){i.onSaveFile(n,d,!0,s,a,t.size);},fail:function fail(e){null!=a&&a.runWith([1,e]);}});},fail:function fail(e){null!=a&&a.runWith([1,e]);}});}},{key:"onClearCacheRes",value:function onClearCacheRes(){var e=l.minClearSize,t=[];for(var n in i.filesListObj){"fileUsedSize"!=n&&t.push(i.filesListObj[n]);}i.sortOn(t,"times",i.NUMERIC);for(var a=0,s=1,o=t.length;s<o;s++){var r=t[s];if(a>=e)break;a+=r.size,i.deleteFile("",r.readyUrl);}}},{key:"sortOn",value:function sortOn(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return n==i.NUMERIC?e.sort(function(e,i){return e[t]-i[t];}):n==(i.NUMERIC|i.DESCENDING)?e.sort(function(e,i){return i[t]-e[t];}):e.sort(function(e,i){return e[t]-i[t];});}},{key:"getFileNativePath",value:function getFileNativePath(e){return i.fileNativeDir+"/"+e;}},{key:"deleteFile",value:function deleteFile(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var o=i.getFileInfo(t),r=i.getFileNativePath(o.md5),l=""!=e;i.onSaveFile(t,e,l,a,n,s),i.fs.unlink({filePath:r,success:function success(t){if(""!=e){var a=i.getFileNativePath(e);i.fs.copyFile({srcPath:e,destPath:a,success:function success(e){},fail:function fail(e){null!=n&&n.runWith([1,e]);}});}},fail:function fail(e){}});}},{key:"deleteAll",value:function deleteAll(){var e=[];for(var t in i.filesListObj){"fileUsedSize"!=t&&e.push(i.filesListObj[t]);}for(var n=1,a=e.length;n<a;n++){var s=e[n];i.deleteFile("",s.readyUrl);}i.filesListObj&&i.filesListObj.fileUsedSize&&(i.filesListObj.fileUsedSize=0),i.writeFilesList("",JSON.stringify({}),!1);}},{key:"onSaveFile",value:function onSaveFile(e,n){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!0;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var o=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var r=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var l=e;if(null==i.filesListObj.fileUsedSize&&(i.filesListObj.fileUsedSize=0),a){i.getFileNativePath(n);i.filesListObj[l]={md5:n,readyUrl:e,size:r,times:t.Browser.now(),encoding:s},i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)+r,i.writeFilesList(l,JSON.stringify(i.filesListObj),!0),null!=o&&o.runWith([0]);}else if(i.filesListObj[l]){var d=parseInt(i.filesListObj[l].size);i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)-d,delete i.filesListObj[l],i.writeFilesList(l,JSON.stringify(i.filesListObj),!1),null!=o&&o.runWith([0]);}}},{key:"writeFilesList",value:function writeFilesList(e,t,n){var a=i.fileNativeDir+"/"+i.fileListName;i.fs.writeFile({filePath:a,encoding:"utf8",data:t,success:function success(e){},fail:function fail(e){}}),!l.isZiYu&&l.isPosMsgYu&&l.window.my.postMessage&&l.window.my.postMessage({url:e,data:i.filesListObj[e],isLoad:"filenative",isAdd:n});}},{key:"getCacheUseSize",value:function getCacheUseSize(){return i.filesListObj&&i.filesListObj.fileUsedSize?i.filesListObj.fileUsedSize:0;}},{key:"existDir",value:function existDir(e,t){i.fs.mkdir({dirPath:e,success:function success(e){null!=t&&t.runWith([0,{data:JSON.stringify({})}]);},fail:function fail(e){10025==e.error?i.readSync(i.fileListName,"utf8",t):null!=t&&t.runWith([1,e]);}});}},{key:"readSync",value:function readSync(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"utf8";var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var s,o=i.getFileNativePath(e);try{i.fs.readFile({filePath:o,encoding:t,success:function success(e){s=e.data,null!=n&&n.runWith([0,{data:s}]);},fail:function fail(){null!=n&&n.runWith([1]);}});}catch(e){null!=n&&n.runWith([1]);}}},{key:"setNativeFileDir",value:function setNativeFileDir(e){i.fileNativeDir=l.window.my.env.USER_DATA_PATH+e;}}]);return i;}();i.fs=window.my.getFileSystemManager(),i.wxdown=window.my.downloadFile,i.filesListObj={},i.fakeObj={},i.fileListName="layaairfiles.txt",i.ziyuFileData={},i.ziyuFileTextureData={},i.loadPath="",i.DESCENDING=2,i.NUMERIC=16;var n=/*#__PURE__*/function(_t$SoundChannel){_inherits(n,_t$SoundChannel);function n(e){var _this;_classCallCheck(this,n);_this=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this)),_this._sound=e,_this._audio=e._sound,_this._onCanplay=_this.onCanPlay.bind(_assertThisInitialized(_this)),_this._onError=_this.onError.bind(_assertThisInitialized(_this)),_this._onEnd=_this.__onEnd.bind(_assertThisInitialized(_this)),_this.addEventListener();return _this;}_createClass(n,[{key:"addEventListener",value:function addEventListener(){this._audio.onError(this._onError),this._audio.onCanplay(this._onCanplay);}},{key:"offEventListener",value:function offEventListener(){this._audio.offError(this._onError),this._audio.offCanplay(this._onCanplay),this._audio.offEnded(this._onEnd);}},{key:"onError",value:function onError(e){console.log("-----1---------------minisound-----url:",this.url),console.log(e),this.event(t.Event.ERROR),this._audio&&(this._sound.dispose(),this.offEventListener(),this._sound=this._audio=null);}},{key:"onCanPlay",value:function onCanPlay(){this._audio&&(this.event(t.Event.COMPLETE),this.offEventListener(),this._audio.onEnded(this._onEnd),this.isStopped?this.stop():this.play());}},{key:"__onEnd",value:function __onEnd(){if(1==this.loops)return this.completeHandler&&(t.Laya.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event(t.Event.COMPLETE);this.loops>0&&this.loops--,this.startTime=0,this.play();}},{key:"play",value:function play(){this.isStopped=!1,t.SoundManager.addChannel(this),this._audio&&this._audio.play();}},{key:"stop",value:function stop(){_get(_getPrototypeOf(n.prototype),"stop",this).call(this),this.isStopped=!0,t.SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this.loop||(this.offEventListener(),this._sound.dispose(),this._sound=null,this._audio=null));}},{key:"pause",value:function pause(){this.isStopped=!0,this._audio&&this._audio.pause();}},{key:"resume",value:function resume(){this.isStopped=!1,t.SoundManager.addChannel(this),this._audio&&this._audio.play();}},{key:"startTime",set:function set(e){this._audio&&(this._audio.startTime=e);}},{key:"autoplay",set:function set(e){this._audio&&(this._audio.autoplay=e);},get:function get(){return!!this._audio&&this._audio.autoplay;}},{key:"position",get:function get(){return this._audio?this._audio.currentTime:0;}},{key:"duration",get:function get(){return this._audio?this._audio.duration:0;}},{key:"loop",get:function get(){return!!this._audio&&this._audio.loop;},set:function set(e){this._audio&&(this._audio.loop=e);}},{key:"volume",set:function set(e){this._audio&&(this._audio.volume=e);},get:function get(){return this._audio?this._audio.volume:0;}}]);return n;}(t.SoundChannel);var a=/*#__PURE__*/function(_t$EventDispatcher){_inherits(a,_t$EventDispatcher);function a(){var _this2;_classCallCheck(this,a);_this2=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this)),_this2.loaded=!1,_this2._sound=a._createSound();return _this2;}_createClass(a,[{key:"load",value:function load(e){if(i.isLocalNativeFile(e)){if(-1==e.indexOf(l.window.my.env.USER_DATA_PATH)&&(-1!=e.indexOf("http://")||-1!=e.indexOf("https://")))if(""!=i.loadPath)e=e.split(i.loadPath)[1];else{var n=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath;""!=n&&(e=e.split(n)[1]);}}else e=t.URL.formatURL(e);if(this.url=e,this.readyUrl=e,l.autoCacheFile&&i.getFileInfo(e))this.onDownLoadCallBack(e,0);else if(l.autoCacheFile){if(i.isLocalNativeFile(e)){if(l.subNativeFiles&&0==l.subNativeheads.length)for(var a in l.subNativeFiles){var s=l.subNativeFiles[a];l.subNativeheads=l.subNativeheads.concat(s);for(var _e=0;_e<s.length;_e++){l.subMaps[s[_e]]=a+"/"+s[_e];}}if(l.subNativeFiles&&-1!=e.indexOf("/")){var o=e.split("/")[0]+"/";if(o&&-1!=l.subNativeheads.indexOf(o)){var r=l.subMaps[o];e=e.replace(o,r);}}this.onDownLoadCallBack(e,0);}else-1==e.indexOf("http://")&&-1==e.indexOf("https://")||-1!=e.indexOf(l.window.my.env.USER_DATA_PATH)?this.onDownLoadCallBack(e,0):i.downOtherFiles(e,t.Handler.create(this,this.onDownLoadCallBack,[e]),e,l.autoCacheFile);}else this.onDownLoadCallBack(e,0);}},{key:"onDownLoadCallBack",value:function onDownLoadCallBack(e,n){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var s;if(n)this.event(t.Event.ERROR);else if(l.autoCacheFile){if(a)s=a;else if(i.isLocalNativeFile(e)){var o=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath,r=e;""==o||-1==e.indexOf("http://")&&-1==e.indexOf("https://")||(s=e.split(o)[1]),s||(s=r),s=l.baseDir+s;}else{var d=i.getFileInfo(e);if(d&&d.md5){var u=d.md5;s=i.getFileNativePath(u);}else s=-1==e.indexOf("http://")&&-1==e.indexOf("https://")&&-1==e.indexOf(l.window.my.env.USER_DATA_PATH)?l.baseDir+e:e;}this._sound.src=this.readyUrl=s;}else(i.isLocalNativeFile(e)||-1==e.indexOf("http://")&&-1==e.indexOf("https://")&&-1==e.indexOf(l.window.my.env.USER_DATA_PATH))&&(e=l.baseDir+e),this._sound.src=this.readyUrl=e;}},{key:"play",value:function play(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(this.isPlaying=!0,!this.url)return null;var a=new n(this);return a.url=this.url,a.loops=i,a.loop=0===i,a.startTime=e,a.play(),t.SoundManager.addChannel(a),a;}},{key:"dispose",value:function dispose(){this._sound&&(a.cachePool.push(this._sound),this._sound=null,this.readyUrl=this.url=null);}},{key:"duration",get:function get(){return this._sound.duration;}}],[{key:"__init__",value:function __init__(){for(var _e2=0;_e2<10;_e2++){var _e3=l.window.my.createInnerAudioContext();a.cachePool.push(_e3);}}},{key:"_createSound",value:function _createSound(){return a.cachePool.length?a.cachePool.pop():l.window.my.createInnerAudioContext();}}]);return a;}(t.EventDispatcher);a.cachePool=[];var s=/*#__PURE__*/function(){function s(){_classCallCheck(this,s);}_createClass(s,null,[{key:"_createInputElement",value:function _createInputElement(){t.Input._initInput(t.Input.area=t.Browser.createElement("textarea")),t.Input._initInput(t.Input.input=t.Browser.createElement("input")),t.Input.inputContainer=t.Browser.createElement("div"),t.Input.inputContainer.style.position="absolute",t.Input.inputContainer.style.zIndex=1e5,t.Browser.container.appendChild(t.Input.inputContainer),t.Laya.stage.on("resize",null,s._onStageResize),l.window.my.onWindowResize&&l.window.my.onWindowResize(function(e){}),t.SoundManager._soundClass=a,t.SoundManager._musicClass=a;var e=l.systemInfo.model,i=l.systemInfo.system;-1!=e.indexOf("iPhone")&&(t.Browser.onIPhone=!0,t.Browser.onIOS=!0,t.Browser.onIPad=!0,t.Browser.onAndroid=!1),-1==i.indexOf("Android")&&-1==i.indexOf("Adr")||(t.Browser.onAndroid=!0,t.Browser.onIPhone=!1,t.Browser.onIOS=!1,t.Browser.onIPad=!1);}},{key:"_onStageResize",value:function _onStageResize(){t.Laya.stage._canvasTransform.identity().scale(t.Browser.width/t.Render.canvas.width/t.Browser.pixelRatio,t.Browser.height/t.Render.canvas.height/t.Browser.pixelRatio);}},{key:"wxinputFocus",value:function wxinputFocus(e){}},{key:"inputEnter",value:function inputEnter(){t.Input.inputElement.target.focus=!1;}},{key:"wxinputblur",value:function wxinputblur(){s.hideKeyboard();}},{key:"hideKeyboard",value:function hideKeyboard(){}}]);return s;}();var o=/*#__PURE__*/function(_t$EventDispatcher2){_inherits(o,_t$EventDispatcher2);function o(){_classCallCheck(this,o);return _possibleConstructorReturn(this,_getPrototypeOf(o).call(this));}_createClass(o,[{key:"_loadResourceFilter",value:function _loadResourceFilter(e,n){if(this.sourceUrl=t.URL.formatURL(n),-1==n.indexOf(l.window.my.env.USER_DATA_PATH)&&(-1!=n.indexOf("http://")||-1!=n.indexOf("https://")))if(""!=i.loadPath)n=n.split(i.loadPath)[1];else{var a=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath,s=n;""!=a&&(n=n.split(a)[1]),n||(n=s);}if(l.subNativeFiles&&0==l.subNativeheads.length)for(var r in l.subNativeFiles){var d=l.subNativeFiles[r];l.subNativeheads=l.subNativeheads.concat(d);for(var u=0;u<d.length;u++){l.subMaps[d[u]]=r+"/"+d[u];}}if(l.subNativeFiles&&-1!=n.indexOf("/")){var c=n.split("/")[0]+"/";if(c&&-1!=l.subNativeheads.indexOf(c)){var h=l.subMaps[c];n=n.replace(c,h);}}switch(e){case t.Loader.IMAGE:case"htmlimage":case"nativeimage":o._transformImgUrl(n,e,this);break;case t.Loader.SOUND:this._loadSound(n);break;default:this._loadResource(e,n);}}},{key:"_loadSound",value:function _loadSound(e){var n=t.URL.formatURL(e);i.isLocalNativeFile(e)||-1==n.indexOf("http://")&&-1==n.indexOf("https://")?o.onDownLoadCallBack(l.baseDir+e,this,0):-1!=n.indexOf(l.window.my.env.USER_DATA_PATH)?o.onDownLoadCallBack(e,this,0):i.downOtherFiles(encodeURI(n),t.Handler.create(o,o.onDownLoadCallBack,[n,this]),n,l.autoCacheFile);}},{key:"complete",value:function complete(e){e instanceof t.Resource?e._setCreateURL(this.sourceUrl):e instanceof t.Texture&&e.bitmap instanceof t.Resource&&e.bitmap._setCreateURL(this.sourceUrl),this.originComplete(e);}},{key:"_loadHttpRequestWhat",value:function _loadHttpRequestWhat(e,n){var a=l.getUrlEncode(e,n);if(t.Loader.preLoadedMap[e])this.onLoaded(t.Loader.preLoadedMap[e]);else{var s=t.URL.formatURL(e),r=i.getFileInfo(s);r?(r.encoding=null==r.encoding?"utf8":r.encoding,i.readFile(i.getFileNativePath(r.md5),a,new t.Handler(o,o.onReadNativeCallBack,[e,n,this]),e)):-1==s.indexOf("http://")&&-1==s.indexOf("https://")||i.isLocalNativeFile(e)?-1==s.indexOf(l.window.my.env.USER_DATA_PATH)?i.readFile(l.baseDir+e,a,new t.Handler(o,o.onReadNativeCallBack,[e,n,this]),e):i.readFile(e,a,new t.Handler(o,o.onReadNativeCallBack,[e,n,this]),e):i.downFiles(encodeURI(s),a,new t.Handler(o,o.onReadNativeCallBack,[e,n,this]),s,l.AutoCacheDownFile);}}}],[{key:"onDownLoadCallBack",value:function onDownLoadCallBack(e,n,a){var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(a)n.event(t.Event.ERROR,"Load sound failed");else{var o;if(l.autoCacheFile){if(s)o=s;else if(i.isLocalNativeFile(e))o=e;else{var r=i.getFileInfo(e);if(r&&r.md5){var d=r.md5;o=i.getFileNativePath(d);}else o=e;}}else o=s||e;e=o;var u=new t.SoundManager._soundClass();u.load(e),n.onLoaded(u);}}},{key:"bindToThis",value:function bindToThis(e,t){return e.bind(t);}},{key:"onReadNativeCallBack",value:function onReadNativeCallBack(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var o;a?1==a&&n.onError&&n.onError(s):(o=i==t.Loader.JSON||i==t.Loader.ATLAS||i==t.Loader.PREFAB||i==t.Loader.PLF?l.getJson(s.data):i==t.Loader.XML?t.Utils.parseXMLFromString(s.data):s.data,n.onLoaded(o));}},{key:"_transformImgUrl",value:function _transformImgUrl(e,n,a){var s=t.URL.formatURL(e);i.isLocalNativeFile(e)||-1==s.indexOf("http://")&&-1==s.indexOf("https://")?-1==s.indexOf(l.window.my.env.USER_DATA_PATH)?o.onCreateImage(e,a,!0):o.onCreateImage(e,a,!1,e):o.onCreateImage(e,a,!1,s);}},{key:"onCreateImage",value:function onCreateImage(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var a;a=i?l.baseDir+e:""!=n?n:e,t._loadImage(encodeURI(a),!1);}}]);return o;}(t.EventDispatcher);var r=/*#__PURE__*/function(){function r(){_classCallCheck(this,r);}_createClass(r,null,[{key:"__init__",value:function __init__(){r.items=r;}},{key:"setItem",value:function setItem(e,t){l.window.my.setStorageSync({key:e,value:t});}},{key:"getItem",value:function getItem(e){return l.window.my.getStorageSync({key:e});}},{key:"setJSON",value:function setJSON(e,t){try{r.setItem(e,JSON.stringify(t));}catch(e){console.warn("set localStorage failed",e);}}},{key:"getJSON",value:function getJSON(e){return JSON.parse(r.getItem(e));}},{key:"removeItem",value:function removeItem(e){l.window.my.removeStorageSync(e);}},{key:"clear",value:function clear(){l.window.my.clearStorageSync();}},{key:"getStorageInfoSync",value:function getStorageInfoSync(){try{var e=l.window.my.getStorageInfoSync();return console.log(e.keys),console.log(e.currentSize),console.log(e.limitSize),e;}catch(e){}return null;}}]);return r;}();r.support=!0;var l=/*#__PURE__*/function(){function l(){_classCallCheck(this,l);}_createClass(l,null,[{key:"getJson",value:function getJson(e){return JSON.parse(e);}},{key:"enable",value:function enable(){l.init(t.Laya.isWXPosMsg,t.Laya.isWXOpenDataContext);}},{key:"init",value:function init(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;l._inited||(l._inited=!0,l.window=window,l.window.hasOwnProperty("my")&&(l.isZiYu=n,l.isPosMsgYu=e,l.EnvConfig={},l.isZiYu||(i.setNativeFileDir("/layaairGame"),i.existDir(i.fileNativeDir,t.Handler.create(l,l.onMkdirCallBack))),l.systemInfo=l.window.my.getSystemInfoSync(),l.window.focus=function(){},t.Laya._getUrlPath=function(){return"";},l.window.logtime=function(e){},l.window.alertTimeLog=function(e){},l.window.resetShareInfo=function(){},l.window.CanvasRenderingContext2D=function(){},l._preCreateElement=t.Browser.createElement,l.window.CanvasRenderingContext2D.prototype=l._preCreateElement("canvas").getContext("2d").__proto__,l.window.document.body.appendChild=function(){},t.Browser.createElement=l.createElement,t.RunDriver.createShaderCondition=l.createShaderCondition,t.Utils.parseXMLFromString=l.parseXMLFromString,t.Input._createInputElement=s._createInputElement,t.Loader.prototype._loadResourceFilter=o.prototype._loadResourceFilter,t.Loader.prototype._loadSound=o.prototype._loadSound,t.Loader.prototype.originComplete=t.Loader.prototype.complete,t.Loader.prototype.complete=o.prototype.complete,t.Loader.prototype._loadHttpRequestWhat=o.prototype._loadHttpRequestWhat,t.Config.useRetinalCanvas=!0,t.LocalStorage._baseClass=r,r.__init__(),a.__init__(),l.window.my.onMessage&&l.window.my.onMessage(l._onMessage)));}},{key:"_onMessage",value:function _onMessage(e){switch(e.type){case"changeMatrix":t.Laya.stage.transform.identity(),t.Laya.stage._width=e.w,t.Laya.stage._height=e.h,t.Laya.stage._canvasTransform=new t.Matrix(e.a,e.b,e.c,e.d,e.tx,e.ty);break;case"display":t.Laya.stage.frameRate=e.rate||t.Stage.FRAME_FAST;break;case"undisplay":t.Laya.stage.frameRate=t.Stage.FRAME_SLEEP;}"opendatacontext"==e.isLoad?e.url&&(i.ziyuFileData[e.url]=e.atlasdata,i.ziyuFileTextureData[e.imgReadyUrl]=e.imgNativeUrl):"openJsondatacontext"==e.isLoad?e.url&&(i.ziyuFileData[e.url]=e.atlasdata):"openJsondatacontextPic"==e.isLoad&&(i.ziyuFileTextureData[e.imgReadyUrl]=e.imgNativeUrl);}},{key:"getUrlEncode",value:function getUrlEncode(e,t){return"arraybuffer"==t?"":"utf8";}},{key:"downLoadFile",value:function downLoadFile(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"utf8";i.getFileInfo(e)?null!=n&&n.runWith([0]):i.downLoadFile(e,t,n,a);}},{key:"remove",value:function remove(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;i.deleteFile("",e,t,"",0);}},{key:"removeAll",value:function removeAll(){i.deleteAll();}},{key:"hasNativeFile",value:function hasNativeFile(e){return i.isLocalNativeFile(e);}},{key:"getFileInfo",value:function getFileInfo(e){return i.getFileInfo(e);}},{key:"getFileList",value:function getFileList(){return i.filesListObj;}},{key:"exitMiniProgram",value:function exitMiniProgram(){l.window.my.exitMiniProgram();}},{key:"onMkdirCallBack",value:function onMkdirCallBack(e,t){e?(i.fakeObj={},i.filesListObj={}):(i.filesListObj=JSON.parse(t.data),i.fakeObj=JSON.parse(t.data)||{}),i.fs.readdir({dirPath:i.fileNativeDir,success:function success(e){var t={};for(var _e4 in i.filesListObj){"fileUsedSize"!=_e4&&(t[i.filesListObj[_e4].md5]=!0);}var n,a=e.files;for(var _e5=0,_o=a.length;_e5<_o;_e5++){if((n=a[_e5])!=i.fileListName){var s=i.getFileNativePath(n);t[s]||t[n]||i.fs.unlink({filePath:s,success:function success(e){console.log("删除无引用的磁盘文件:"+n);}});}}}});}},{key:"pixelRatio",value:function pixelRatio(){if(!l.EnvConfig.pixelRatioInt)try{return l.EnvConfig.pixelRatioInt=l.systemInfo.pixelRatio,l.systemInfo.pixelRatio;}catch(e){}return l.EnvConfig.pixelRatioInt;}},{key:"createElement",value:function createElement(e){var t;if("canvas"==e)return!(t=1==l.idx?l.window.canvas.getRealCanvas():l._preCreateElement(e)).style&&(t.style={}),l.idx++,t;if("textarea"==e||"input"==e)return l.onCreateInput(e);if("div"==e){var i=l._preCreateElement(e);return i.contains=function(e){return null;},i.removeChild=function(e){},i;}return l._preCreateElement(e);}},{key:"onCreateInput",value:function onCreateInput(e){var t=l._preCreateElement(e);return t.focus=s.wxinputFocus,t.blur=s.wxinputblur,t.value=0,t.placeholder={},t.type={},t.setColor=function(e){},t.setType=function(e){},t.setFontFace=function(e){},t.contains=function(e){return null;},t;}},{key:"createShaderCondition",value:function createShaderCondition(e){return function(){return this[e.replace("this.","")];};}}]);return l;}();l._inited=!1,l.autoCacheFile=!0,l.minClearSize=5242880,l.nativefiles=["layaNativeDir"],l.subNativeFiles=[],l.subNativeheads=[],l.subMaps=[],l.AutoCacheDownFile=!1,l.baseDir="pages/index/",l.parseXMLFromString=function(e){var t;e=e.replace(/>\s+</g,"><");try{t=new l.window.Parser.DOMParser().parseFromString(e,"text/xml");}catch(e){throw"需要引入xml解析库文件";}return t;},l.idx=1;var d=/*#__PURE__*/function(_t$EventDispatcher3){_inherits(d,_t$EventDispatcher3);function d(){_classCallCheck(this,d);return _possibleConstructorReturn(this,_getPrototypeOf(d).call(this));}_createClass(d,[{key:"on",value:function on(e,t,i){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;return _get(_getPrototypeOf(d.prototype),"on",this).call(this,e,t,i,n),d.startListen(this.onDeviceOrientationChange),this;}},{key:"off",value:function off(e,t,i){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!1;return this.hasListener(e)||d.stopListen(),_get(_getPrototypeOf(d.prototype),"off",this).call(this,e,t,i,n);}}],[{key:"__init__",value:function __init__(){try{var e;if(!(e=t.Accelerator))return;e.prototype.on=d.prototype.on,e.prototype.off=d.prototype.off;}catch(e){}}},{key:"startListen",value:function startListen(e){if(d._callBack=e,!d._isListening){d._isListening=!0;try{l.window.my.onAccelerometerChange(d.onAccelerometerChange);}catch(e){}}}},{key:"stopListen",value:function stopListen(){d._isListening=!1;try{l.window.my.stopAccelerometer({});}catch(e){}}},{key:"onAccelerometerChange",value:function onAccelerometerChange(e){var t;(t={}).acceleration=e,t.accelerationIncludingGravity=e,t.rotationRate={},null!=d._callBack&&d._callBack(t);}}]);return d;}(t.EventDispatcher);d._isListening=!1;var u=/*#__PURE__*/function(){function u(){_classCallCheck(this,u);}_createClass(u,null,[{key:"__init__",value:function __init__(){l.window.navigator.geolocation.getCurrentPosition=u.getCurrentPosition,l.window.navigator.geolocation.watchPosition=u.watchPosition,l.window.navigator.geolocation.clearWatch=u.clearWatch;}},{key:"getCurrentPosition",value:function getCurrentPosition(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var n;(n={}).success=function(t){null!=e&&e(t);},n.fail=t,l.window.my.getLocation(n);}},{key:"watchPosition",value:function watchPosition(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var a;return u._curID++,(a={}).success=e,a.error=i,u._watchDic[u._curID]=a,t.Laya.systemTimer.loop(1e3,null,u._myLoop),u._curID;}},{key:"clearWatch",value:function clearWatch(e){delete u._watchDic[e],u._hasWatch()||t.Laya.systemTimer.clear(null,u._myLoop);}},{key:"_hasWatch",value:function _hasWatch(){var e;for(e in u._watchDic){if(u._watchDic[e])return!0;}return!1;}},{key:"_myLoop",value:function _myLoop(){u.getCurrentPosition(u._mySuccess,u._myError);}},{key:"_mySuccess",value:function _mySuccess(e){var i,n={};for(i in n.coords=e,n.timestamp=t.Browser.now(),u._watchDic){u._watchDic[i].success&&u._watchDic[i].success(n);}}},{key:"_myError",value:function _myError(e){var t;for(t in u._watchDic){u._watchDic[t].error&&u._watchDic[t].error(e);}}}]);return u;}();u._watchDic={},u._curID=0;e.MiniAccelerator=d,e.MiniFileMgr=i,e.MiniInput=s,e.MiniLoader=o,e.MiniLocalStorage=r,e.MiniLocation=u,e.MiniSound=a,e.MiniSoundChannel=n,e.MiniVideo=/*#__PURE__*/function(){function _class(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:320;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:240;_classCallCheck(this,_class);this.videoend=!1,this.videourl="",this.videoElement=l.window.my.createVideo({width:e,height:t,autoplay:!0});}_createClass(_class,[{key:"on",value:function on(e,t,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(t),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=i.bind(t),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this);}},{key:"onTimeUpdateFunc",value:function onTimeUpdateFunc(e){this.position=e.position,this._duration=e.duration;}},{key:"onPlayFunction",value:function onPlayFunction(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====视频加载完成========"),null!=this.onPlayFunc&&this.onPlayFunc();}},{key:"onEndedFunction",value:function onEndedFunction(){this.videoElement&&(this.videoend=!0,console.log("=====视频播放完毕========"),null!=this.onEndedFunC&&this.onEndedFunC());}},{key:"off",value:function off(e,t,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(t),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=i.bind(t),this.videoElement.offEnded=this.onEndedFunction.bind(this));}},{key:"load",value:function load(e){this.videoElement&&(this.videoElement.src=e);}},{key:"play",value:function play(){this.videoElement&&(this.videoend=!1,this.videoElement.play());}},{key:"pause",value:function pause(){this.videoElement&&(this.videoend=!0,this.videoElement.pause());}},{key:"size",value:function size(e,t){this.videoElement&&(this.videoElement.width=e,this.videoElement.height=t);}},{key:"destroy",value:function destroy(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null;}},{key:"reload",value:function reload(){this.videoElement&&(this.videoElement.src=this.videourl);}},{key:"duration",get:function get(){return this._duration;}},{key:"currentTime",get:function get(){return this.videoElement?this.videoElement.initialTime:0;},set:function set(e){this.videoElement&&(this.videoElement.initialTime=e);}},{key:"videoWidth",get:function get(){return this.videoElement?this.videoElement.width:0;}},{key:"videoHeight",get:function get(){return this.videoElement?this.videoElement.height:0;}},{key:"ended",get:function get(){return this.videoend;}},{key:"loop",get:function get(){return!!this.videoElement&&this.videoElement.loop;},set:function set(e){this.videoElement&&(this.videoElement.loop=e);}},{key:"playbackRate",get:function get(){return this.videoElement?this.videoElement.playbackRate:0;},set:function set(e){this.videoElement&&(this.videoElement.playbackRate=e);}},{key:"muted",get:function get(){return!!this.videoElement&&this.videoElement.muted;},set:function set(e){this.videoElement&&(this.videoElement.muted=e);}},{key:"paused",get:function get(){return!!this.videoElement&&this.videoElement.paused;}},{key:"x",get:function get(){return this.videoElement?this.videoElement.x:0;},set:function set(e){this.videoElement&&(this.videoElement.x=e);}},{key:"y",get:function get(){return this.videoElement?this.videoElement.y:0;},set:function set(e){this.videoElement&&(this.videoElement.y=e);}},{key:"currentSrc",get:function get(){return this.videoElement.src;}}],[{key:"__init__",value:function __init__(){}}]);return _class;}(),e.TBMiniAdapter=l;};